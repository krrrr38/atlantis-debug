version: 3
projects:
- name: project
  branch: /master/
  dir: .
  workflow: terragrunt
  autoplan:
    enabled: false
workflows:
  terragrunt:
    plan:
      steps:
      - run: terragrunt plan -input=false -out=$PLANFILE
      - run: terragrunt show -json $PLANFILE > $SHOWFILE
    apply:
      steps:
      - run: terragrunt apply -input=false $PLANFILE
    import:
      steps:
      - env:
          name: IMPORT_ARGS
          command: printf '%s' $COMMENT_ARGS | sed 's/,/ /' | tr -d '\'
      - run: terragrunt import $IMPORT_ARGS
